<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚»ã‚­ãƒ¥ã‚¢æ›¸ç”»ã‚«ãƒ¡ãƒ©</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #000; margin: 0; display: flex; flex-direction: column; height: 100vh; height: 100dvh; overflow: hidden; }
        .video-container { flex: 1; position: relative; display: flex; align-items: center; justify-content: center; background: #000; overflow: hidden; }
        video { position: absolute; background: #000; transition: transform 0.2s ease-out; will-change: transform; }
        .controls { height: 100px; background: #1a1a1a; display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 12px; box-sizing: border-box; border-top: 1px solid #333; z-index: 100; }
        button { font-size: 16px; border-radius: 12px; border: none; color: white; cursor: pointer; font-weight: bold; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        button:active { opacity: 0.7; }
        .btn-pc { background: #0066ff; }
        .btn-sm { background: #28a745; }
        .btn-rot { background: #444; }
        .icon { font-size: 20px; margin-bottom: 2px; }
    </style>
</head>
<body>

    <div class="video-container" id="container">
        <video id="videoView" autoplay playsinline></video>
    </div>

    <div class="controls">
        <button class="btn-pc" onclick="startMonitor()"><span class="icon">ğŸ’»</span>â‘  è¦–è´é–‹å§‹</button>
        <button class="btn-sm" onclick="startCamera()"><span class="icon">ğŸ“±</span>â‘¡ é…ä¿¡é–‹å§‹</button>
        <button class="btn-rot" onclick="toggleRotate()"><span class="icon">ğŸ”„</span>æ˜ åƒã‚’å›è»¢</button>
    </div>

    <script>
        // ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã€‘IDã‚’è‡ªåˆ†å°‚ç”¨ã®è¤‡é›‘ãªã‚‚ã®ã«å¤‰æ›´ã—ã¦ãã ã•ã„
        const MONITOR_ID = 'skk-secure-monitor-8822-2026'; 
        let peer = new Peer({ debug: 1 });
        let rotation = 0;

        function startMonitor() {
            if (peer) peer.destroy();
            peer = new Peer(MONITOR_ID);
            peer.on('call', call => {
                call.answer();
                call.on('stream', stream => {
                    const video = document.getElementById('videoView');
                    video.srcObject = stream;
                    video.onloadedmetadata = () => updateLayout();
                });
            });
        }

        async function startCamera() {
            const constraints = {
                video: { width: { ideal: 3840 }, height: { ideal: 2160 }, facingMode: "environment", frameRate: { max: 15 } },
                audio: false
            };
            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.getElementById('videoView');
                video.srcObject = stream;
                const call = peer.call(MONITOR_ID, stream);
                const pc = call.peerConnection;
                pc.oniceconnectionstatechange = async () => {
                    if (pc.iceConnectionState === 'connected') {
                        const sender = pc.getSenders().find(s => s.track.kind === 'video');
                        const params = sender.getParameters();
                        if (!params.encodings) params.encodings = [{}];
                        params.encodings[0].maxBitrate = 20000000;
                        params.encodings[0].scaleResolutionDownBy = 1.0;
                        await sender.setParameters(params);
                    }
                };
                video.onloadedmetadata = () => updateLayout();
            } catch (err) { alert("ã‚«ãƒ¡ãƒ©è¨±å¯ãŒå¿…è¦ã§ã™"); }
        }

        function toggleRotate() { rotation = (rotation + 90) % 360; updateLayout(); }

        function updateLayout() {
            const video = document.getElementById('videoView');
            const container = document.getElementById('container');
            const vW = video.videoWidth; const vH = video.videoHeight;
            const cW = container.clientWidth; const cH = container.clientHeight;
            if (!vW || !vH) return;
            let scale = 1;
            if (rotation === 0 || rotation === 180) { scale = Math.min(cW / vW, cH / vH); }
            else { scale = Math.min(cW / vH, cH / vW); }
            video.style.width = vW + "px"; video.style.height = vH + "px";
            video.style.transform = `rotate(${rotation}deg) scale(${scale})`;
        }
        window.addEventListener('resize', updateLayout);
    </script>
</body>
</html>
