<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªä½œãƒ»é«˜ç”»è³ªæ›¸ç”»ã‚«ãƒ¡ãƒ©</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #222; color: white; text-align: center; margin: 0; overflow: hidden; }
        video { width: 100dvw; height: 80dvh; object-fit: contain; background: #000; transition: transform 0.3s; }
        .controls { padding: 10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; background: #333; height: 20dvh; }
        button { padding: 10px; font-size: 14px; border-radius: 8px; border: none; background: #444; color: white; cursor: pointer; }
        button:active { background: #666; }
        .active { background: #007bff; }
    </style>
</head>
<body>

    <video id="videoView" autoplay playsinline></video>

    <div class="controls">
        <button onclick="startMonitor()" id="btnMon">â‘  PCï¼šè¦–è´é–‹å§‹</button>
        <button onclick="startCamera()" id="btnCam">â‘¡ ã‚¹ãƒãƒ›ï¼šé…ä¿¡é–‹å§‹</button>
        <button onclick="toggleRotate()">ğŸ”„ æ˜ åƒå›è»¢</button>
        <button onclick="toggleLight()">ğŸ’¡ ãƒ©ã‚¤ãƒˆç‚¹ç¯</button>
        <button onclick="toggleZoom()">ğŸ” ã‚ºãƒ¼ãƒ </button>
        <button onclick="location.reload()">ğŸ”ƒ ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <script>
        // IDã¯ä»–ã¨è¢«ã‚‰ãªã„ã‚ˆã†ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚‚ã®ã‚’è¨­å®š
        const PEER_ID = 'seikeikai-doc-cam-2026'; 
        const peer = new Peer(PEER_ID);
        let localStream;
        let rotation = 0;
        let isZoomed = false;

        // ã€ãƒ¢ãƒ‹ã‚¿ãƒ¼å´ï¼ˆå—ä¿¡ï¼‰ã€‘
        function startMonitor() {
            document.getElementById('btnMon').classList.add('active');
            peer.on('call', call => {
                call.answer();
                call.on('stream', stream => {
                    document.getElementById('videoView').srcObject = stream;
                });
            });
        }

        // ã€ã‚«ãƒ¡ãƒ©å´ï¼ˆé€ä¿¡ï¼‰ã€‘
        async function startCamera() {
            document.getElementById('btnCam').classList.add('active');
            const constraints = {
                video: {
                    width: { ideal: 3840 }, // 4Kã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                    height: { ideal: 2160 },
                    facingMode: "environment", // èƒŒé¢ã‚«ãƒ¡ãƒ©
                    frameRate: { ideal: 20 }  // æ›¸ç”»ã‚«ãƒ¡ãƒ©ãªã®ã§å°‘ã—è½ã¨ã—ã¦ç”»è³ªå„ªå…ˆ
                },
                audio: false
            };

            try {
                localStream = await navigator.mediaDevices.getUserMedia(constraints);
                document.getElementById('videoView').srcObject = localStream;
                peer.call(PEER_ID, localStream);
            } catch (err) {
                alert("ã‚«ãƒ¡ãƒ©èµ·å‹•ã‚¨ãƒ©ãƒ¼: " + err);
            }
        }

        // æ˜ åƒã‚’90åº¦ãšã¤å›è»¢
        function toggleRotate() {
            rotation = (rotation + 90) % 360;
            document.getElementById('videoView').style.transform = `rotate(${rotation}deg) scale(${isZoomed ? 1.5 : 1})`;
        }

        // ãƒ‡ã‚¸ã‚¿ãƒ«ã‚ºãƒ¼ãƒ ï¼ˆ1.5å€ï¼‰
        function toggleZoom() {
            isZoomed = !isZoomed;
            document.getElementById('videoView').style.transform = `rotate(${rotation}deg) scale(${isZoomed ? 1.5 : 1})`;
        }

        // ãƒ©ã‚¤ãƒˆç‚¹ç¯ï¼ˆã‚¹ãƒãƒ›ã®ã¿æœ‰åŠ¹ï¼‰
        async function toggleLight() {
            if (!localStream) return;
            const track = localStream.getVideoTracks()[0];
            const capabilities = track.getCapabilities();
            if (capabilities.torch) {
                const settings = track.getSettings();
                await track.applyConstraints({
                    advanced: [{ torch: !settings.torch }]
                });
            } else {
                alert("ã“ã®ç«¯æœ«ã¯ãƒ©ã‚¤ãƒˆåˆ¶å¾¡ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“");
            }
        }
    </script>
</body>
</html>
